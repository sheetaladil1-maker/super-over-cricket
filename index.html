<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Super Over ‚Äî Retro Cricket</title>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- canvas-confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<!-- Retro font -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{--accent:#00ffb3;--bg1:#071218;--card:rgba(255,255,255,0.03)}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Montserrat, Arial, sans-serif;
  background:linear-gradient(180deg,#051018 0%, #082933 100%);
  color:#e6fff6;
}
header{display:flex;align-items:center;justify-content:space-between;padding:12px 18px;border-bottom:1px solid rgba(255,255,255,0.03)}
header h1{font-family:'Press Start 2P',monospace;font-size:18px;margin:0;color:var(--accent)}
header .sub{font-size:12px;color:rgba(255,255,255,0.6)}

.top-row{display:flex;align-items:center;justify-content:space-between;padding:18px;gap:12px;max-width:1100px;margin:12px auto}
.player-card{width:160px;display:flex;flex-direction:column;align-items:center}
.player-icon{width:88px;height:88px;border-radius:50%;background:linear-gradient(135deg,#00c28a,#0096ff);display:flex;align-items:center;justify-content:center;font-weight:800;color:#012;box-shadow:0 10px 24px rgba(0,0,0,0.6);font-size:20px}
.player-name{margin-top:8px;font-size:13px;color:rgba(255,255,255,0.9)}
.balls-row{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;justify-content:center}
.ball-pill{width:30px;height:30px;border-radius:15px;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;font-weight:700;color:#e6fff6;font-size:12px}

.center-score{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center}
.scoreboard{background:var(--card);padding:14px 18px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);min-width:240px;text-align:center}
.score-main{display:flex;align-items:baseline;gap:12px;justify-content:center}
.runs{font-size:44px;font-weight:800;color:var(--accent);font-family:'Press Start 2P',monospace}
.overs{font-size:14px;color:rgba(255,255,255,0.8)}
.subtext{font-size:12px;color:rgba(255,255,255,0.7);margin-top:8px}

.controls{display:flex;gap:12px;justify-content:center;padding:18px}
.btn{background:linear-gradient(180deg,#072b2a,#083b3a);border:1px solid rgba(0,255,179,0.08);padding:10px 18px;border-radius:10px;color:var(--accent);cursor:pointer;font-family:'Press Start 2P',monospace}
.btn:disabled{opacity:.35;cursor:not-allowed}

#chartWrap{max-width:760px;margin:18px auto;padding:8px;background:var(--card);border-radius:10px}
#commentary{max-width:760px;margin:12px auto;padding:12px;background:rgba(0,0,0,0.15);border-radius:8px;color:#cffff0;height:140px;overflow:auto;font-size:13px}

footer{position:fixed;left:12px;bottom:12px;font-size:12px;color:rgba(255,255,255,0.5)}

/* Winner Overlay */
.winner-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:9999}
.winner-screen{position:relative;width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;background:radial-gradient(circle at center, rgba(0,0,0,0.25), rgba(0,0,0,0.95));backdrop-filter:blur(2px)}
.grid-bg{position:absolute;inset:0;background-image:linear-gradient(to right, rgba(0,255,0,0.06) 1px, transparent 1px),linear-gradient(to bottom, rgba(0,255,0,0.06) 1px, transparent 1px);background-size:20px 20px;z-index:0}
.brick-text{position:relative;font-family:'Press Start 2P',monospace;color:var(--accent);font-size:26px;text-shadow:0 0 10px rgba(0,255,179,0.8),0 0 24px rgba(0,163,255,0.6);animation:pop 1s ease-in-out infinite;z-index:1}
@keyframes pop{0%{transform:scale(0.95)}50%{transform:scale(1.06)}100%{transform:scale(0.95)}}
.restart-w{margin-top:18px;font-size:14px;color:var(--accent);font-family:'Press Start 2P',monospace}
.card-score{margin-top:18px;padding:12px;border-radius:10px;background:rgba(0,0,0,0.25);color:#e6fff6;font-family:Montserrat,Arial,sans-serif}
@media (max-width:860px){.top-row{flex-direction:column;align-items:center}.player-card{width:110px}.center-score{margin:12px 0}}
</style>
</head>
<body>

<header>
  <h1>SUPER OVER</h1>
  <div class="sub">Retro Edition</div>
</header>

<section class="top-row">
  <div class="player-card">
    <div class="player-icon" id="p1Icon">P1</div>
    <div class="player-name">Player 1</div>
    <div class="balls-row" id="p1Balls"></div>
    <div style="margin-top:8px;font-size:12px;color:rgba(255,255,255,0.7)">
      Total: <span id="p1Total">0</span> (<span id="p1BallsCount">0</span> balls)
    </div>
  </div>

  <div class="center-score">
    <div class="scoreboard">
      <div class="score-main">
        <div class="runs" id="centerRuns">0</div>
        <div class="overs" id="centerOvers">0.0</div>
      </div>
      <div class="subtext">Batting: <span id="currentBatting">Player 1</span> ‚Ä¢ Target: <span id="targetDisplay">-</span></div>
    </div>
  </div>

  <div class="player-card">
    <div class="player-icon" id="p2Icon">P2</div>
    <div class="player-name">Player 2</div>
    <div class="balls-row" id="p2Balls"></div>
    <div style="margin-top:8px;font-size:12px;color:rgba(255,255,255,0.7)">
      Total: <span id="p2Total">0</span> (<span id="p2BallsCount">0</span> balls)
    </div>
  </div>
</section>

<div class="controls">
  <button class="btn" id="startBtn">Start Match</button>
  <button class="btn" id="hitBtn" disabled>Hit (Play Ball)</button>
  <button class="btn" id="resetBtn">Reset</button>
</div>

<div id="chartWrap"><canvas id="barChart" height="100"></canvas></div>
<div id="commentary">Ball-by-ball commentary will appear here (latest on top)...</div>
<footer>Made with ‚ù§Ô∏è ‚Äî Super Over</footer>

<!-- Winner Overlay (keeps structure; content updated from JS) -->
<div class="winner-overlay" id="winnerOverlay">
  <div class="winner-screen">
    <div class="grid-bg"></div>
    <div class="brick-text" id="winnerText">PLAYER X WINS!</div>
    <div class="restart-w" id="countdownText">Next match starts in 5...</div>
    <!-- scorecard area (JS will insert) -->
  </div>
</div>

<!-- Sounds (working URLs) -->
<audio id="batHitSound" src="https://assets.mixkit.co/sfx/preview/mixkit-fast-baseball-hit-2105.mp3" preload="auto"></audio>
<audio id="crowdCheerSound" src="https://assets.mixkit.co/sfx/preview/mixkit-crowd-cheer-532.mp3" preload="auto"></audio>
<audio id="winSound" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" preload="auto"></audio>

<script>
/* ---------- State ---------- */
let p1 = { name: 'Player 1', runs: 0, balls: [] };
let p2 = { name: 'Player 2', runs: 0, balls: [] };
let innings = 1;
let ballsLeft = 6;
let gameOver = false;
let target = null;
let winnerHueInterval = null;

const outcomes = [0,1,2,3,4,6,'OUT'];

/* DOM */
const startBtn = document.getElementById('startBtn');
const hitBtn = document.getElementById('hitBtn');
const resetBtn = document.getElementById('resetBtn');
const p1BallsEl = document.getElementById('p1Balls');
const p2BallsEl = document.getElementById('p2Balls');
const p1TotalEl = document.getElementById('p1Total');
const p2TotalEl = document.getElementById('p2Total');
const p1BallsCountEl = document.getElementById('p1BallsCount');
const p2BallsCountEl = document.getElementById('p2BallsCount');
const centerRunsEl = document.getElementById('centerRuns');
const centerOversEl = document.getElementById('centerOvers');
const currentBattingEl = document.getElementById('currentBatting');
const targetDisplayEl = document.getElementById('targetDisplay');
const commentaryEl = document.getElementById('commentary');
const winnerOverlay = document.getElementById('winnerOverlay');
const winnerText = document.getElementById('winnerText');
const countdownText = document.getElementById('countdownText');

const batHitSound = document.getElementById('batHitSound');
const crowdCheerSound = document.getElementById('crowdCheerSound');
const winSound = document.getElementById('winSound');

/* Chart */
let chart = null;
function initChart(){
  const ctx = document.getElementById('barChart').getContext('2d');
  chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['B1','B2','B3','B4','B5','B6'],
      datasets: [{
        label: 'Runs',
        data: [0,0,0,0,0,0],
        backgroundColor: Array(6).fill('rgba(0,255,179,0.9)')
      }]
    },
    options: {
      scales: { y: { beginAtZero:true, max:6 } },
      plugins: { legend: { display:false } },
      animation: { duration: 250 }
    }
  });
}
initChart();

/* ---------- Helpers ---------- */
function randOutcome(){ return outcomes[Math.floor(Math.random()*outcomes.length)]; }
function addComment(text){
  const d = document.createElement('div');
  d.textContent = `${new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'})} ‚Äî ${text}`;
  commentaryEl.prepend(d);
}
function renderBalls(){
  p1BallsEl.innerHTML = ''; p1.balls.forEach(r=>{ const el=document.createElement('div'); el.className='ball-pill'; el.textContent=(r==='OUT'?'W':r); p1BallsEl.appendChild(el);});
  p2BallsEl.innerHTML = ''; p2.balls.forEach(r=>{ const el=document.createElement('div'); el.className='ball-pill'; el.textContent=(r==='OUT'?'W':r); p2BallsEl.appendChild(el);});
  p1TotalEl.textContent = p1.runs; p2TotalEl.textContent = p2.runs;
  p1BallsCountEl.textContent = p1.balls.length; p2BallsCountEl.textContent = p2.balls.length;
}
function updateCenter(){
  const battingObj = (innings===1? p1 : p2);
  centerRunsEl.textContent = battingObj.runs;
  const ballsBowled = battingObj.balls.length;
  centerOversEl.textContent = `${Math.floor(ballsBowled/6)}.${ballsBowled%6}`;
  currentBattingEl.textContent = battingObj.name;
  targetDisplayEl.textContent = (innings===1 ? '-' : (target===null ? '-' : target));
}
function updateChart(){
  const battingObj = (innings===1? p1 : p2);
  const arr = [];
  for(let i=0;i<6;i++){
    const v = battingObj.balls[i];
    arr.push(v==='OUT'?0:(typeof v==='number'? v : 0));
  }
  chart.data.datasets[0].data = arr;
  chart.update();
}

/* ---------- Game flow ---------- */
function startMatch(){
  p1 = { name:'Player 1', runs:0, balls:[] };
  p2 = { name:'Player 2', runs:0, balls:[] };
  innings = 1; ballsLeft = 6; gameOver = false; target = null;
  startBtn.disabled = true; hitBtn.disabled = false;
  addComment('Match started ‚Äî Player 1 batting (no toss).');
  updateCenter(); renderBalls(); updateChart(); hideWinnerOverlay();
}

/* Core playBall */
function playBall(){
  if(gameOver) return;

  // play bat sound (user gesture needed first)
  try { batHitSound.currentTime = 0; batHitSound.play(); } catch(e){}

  const outcome = randOutcome();
  addComment(`Player ${innings} ‚Äî ${outcome === 'OUT' ? 'OUT' : outcome + ' run(s)'}`);

  if(innings===1){
    p1.balls.push(outcome);
    if(outcome !== 'OUT') p1.runs += outcome;
  } else {
    p2.balls.push(outcome);
    if(outcome !== 'OUT') p2.runs += outcome;
  }

  // fireworks + cheer for 4/6
  if(outcome === 4 || outcome === 6){
    try { crowdCheerSound.currentTime = 0; crowdCheerSound.play(); } catch(e){}
    confetti({ particleCount: 120, spread: 100, origin: { y: 0.35 } });
  }

  ballsLeft--;
  renderBalls(); updateCenter(); updateChart();

  // --- End of 1st innings: 3-second break before Player 2 ---
  if(innings===1 && ballsLeft===0){
    target = p1.runs + 1;
    addComment(`End of Innings 1 ‚Äî Player 1 scored ${p1.runs}.`);
    addComment(`üé¨ Break for 3 seconds... Player 2's inning will start soon!`);
    hitBtn.disabled = true;
    centerRunsEl.textContent = '---';
    centerOversEl.textContent = '';
    currentBattingEl.textContent = 'BREAK';
    targetDisplayEl.textContent = '-';

    setTimeout(()=>{
      innings = 2; ballsLeft = 6;
      addComment(`üèè Player 2's inning starts! Target: ${target}`);
      hitBtn.disabled = false;
      updateCenter(); updateChart();
    }, 3000);
    return;
  }

  // --- Player 2 end / chase check ---
  if(innings===2 && (ballsLeft===0 || p2.runs >= target)){
    if(p2.runs >= target){
      announceWinner(2);
    } else {
      announceWinner( p1.runs > p2.runs ? 1 : (p2.runs > p1.runs ? 2 : 0) );
    }
    return;
  }
}

/* announce winner with full scorecard + restart button */
function announceWinner(playerNum){
  gameOver = true;
  hitBtn.disabled = true;
  startBtn.disabled = false;

  // prepare overlay structure (keep existing elements)
  winnerText.textContent = `üèÜ ${playerNum===0 ? 'MATCH TIED' : (playerNum===1? p1.name+' WINS' : p2.name+' WINS')} üèÜ`;
  winnerOverlay.style.display = 'flex';
  try { winSound.currentTime = 0; winSound.play(); } catch(e){}

  // insert scorecard + restart button into winner screen (not overwriting grid/bg)
  const winnerScreen = winnerOverlay.querySelector('.winner-screen');
  // remove previous card if present
  const oldCard = winnerScreen.querySelector('.card-score');
  if(oldCard) oldCard.remove();

  const card = document.createElement('div');
  card.className = 'card-score';
  card.innerHTML = `
    <div style="font-weight:700;margin-bottom:8px">Final Scorecard</div>
    <div>Player 1: <strong>${p1.runs}</strong> runs (${p1.balls.length} balls)</div>
    <div>Player 2: <strong>${p2.runs}</strong> runs (${p2.balls.length} balls)</div>
    <div style="margin-top:8px;color:#00ffb3">Target was: ${target === null ? '-' : target}</div>
    <button id="restartGameBtn" style="margin-top:12px;padding:10px 14px;border-radius:8px;border:1px solid rgba(0,255,179,0.12);background:#041313;color:var(--accent);cursor:pointer;font-family:'Press Start 2P',monospace">
      üîÅ Restart Match
    </button>
  `;
  winnerScreen.appendChild(card);

  // glow animation
  let hue = 0;
  if(winnerHueInterval) clearInterval(winnerHueInterval);
  winnerHueInterval = setInterval(()=>{
    hue = (hue + 12) % 360;
    winnerText.style.textShadow = `0 0 10px hsl(${hue},100%,50%),0 0 20px hsl(${(hue+60)%360},100%,50())`;
  },160);

  // confetti
  confetti({ particleCount: 400, spread: 360, origin: { y: 0.45 } });

  // restart handler
  setTimeout(()=>{ // small timeout to ensure button exists
    const btn = document.getElementById('restartGameBtn');
    if(btn) btn.onclick = () => { hideWinnerOverlay(); resetMatch(); };
  }, 150);
}

function hideWinnerOverlay(){
  winnerOverlay.style.display = 'none';
  // remove scorecard if present
  const winnerScreen = winnerOverlay.querySelector('.winner-screen');
  const oldCard = winnerScreen.querySelector('.card-score');
  if(oldCard) oldCard.remove();
  if(winnerHueInterval){ clearInterval(winnerHueInterval); winnerHueInterval = null; }
  winnerText.style.textShadow = '';
  countdownText.textContent = 'Next match starts in 5...';
}

/* reset but not reload */
function resetMatch(){
  hideWinnerOverlay();
  p1 = { name:'Player 1', runs:0, balls:[] };
  p2 = { name:'Player 2', runs:0, balls:[] };
  innings = 1; ballsLeft = 6; target = null; gameOver = false;
  hitBtn.disabled = true;
  startBtn.disabled = false;
  p1TotalEl.textContent = '0'; p2TotalEl.textContent = '0';
  p1BallsCountEl.textContent = '0'; p2BallsCountEl.textContent = '0';
  centerRunsEl.textContent = '0'; centerOversEl.textContent = '0.0';
  targetDisplayEl.textContent = '-';
  commentaryEl.innerHTML = '';
  renderBalls(); updateChart();
  addComment('Match reset. Click Start Match to play again.');
}

/* events */
startBtn.addEventListener('click', startMatch);
hitBtn.addEventListener('click', playBall);
resetBtn.addEventListener('click', resetMatch);

/* init */
renderBalls(); updateCenter(); updateChart();
addComment('Ready. Click "Start Match" to begin (Player 1 bats first).');
</script>
</body>
</html>
